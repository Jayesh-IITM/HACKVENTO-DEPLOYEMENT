<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Silent Syntax Portal ¬∑ Register</title>
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <main>
    <div class="page-shell">
      <header class="header">
        <div class="brand">
          <img class="brand-icon" src="/brand/silent-syntax-icon.png" alt="Silent Syntax" />
          <div class="pill">Silent Syntax Portal</div>
          <span class="pill">Create your account</span>
        </div>
        <nav class="nav">
          <a class="nav-back" href="/" aria-label="Back to landing page">‚Üê Landing</a>
          <a href="index.html">Login</a>
          <a class="active" href="register.html">Register</a>
        </nav>
      </header>

      <section class="hero-landing">
        <div class="hero-content">
          <div class="pill" style="margin-bottom: 20px;">üéì Student ‚Ä¢ Company access</div>
          <h1 class="landing-title">Join Silent Syntax Portal</h1>
          <p class="landing-subtitle">Students can browse and apply to jobs. Companies can publish openings and review applicants. Start your journey today.</p>
        </div>

        <div class="register-container">
          <div class="card glass animate" style="padding: 32px; max-width: 600px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 24px;">
              <h2 style="font-size: 28px; margin-bottom: 8px;">Create Account</h2>
              <p class="minor">Choose a role and fill the required fields</p>
            </div>
          <form id="register-form" class="grid" style="gap: 18px;">
            <div style="display: flex; gap: 12px; justify-content: center; padding: 12px; background: rgba(124, 58, 237, 0.1); border-radius: var(--radius-sm); border: 1px solid rgba(124, 58, 237, 0.2);">
              <label style="cursor: pointer; display: flex; align-items: center; gap: 6px; font-weight: 600;">
                <input type="radio" name="role" value="1" checked style="width: auto;">
                <span>üéì Student</span>
              </label>
              <label style="cursor: pointer; display: flex; align-items: center; gap: 6px; font-weight: 600;">
                <input type="radio" name="role" value="2" style="width: auto;">
                <span>üè¢ Company</span>
              </label>
            </div>

            <div class="grid grid-2">
              <div>
                <label for="email">Email</label>
                <input id="email" name="email" type="email" required placeholder="you@domain.com">
              </div>
              <div>
                <label for="password">Password</label>
                <input id="password" name="password" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
              </div>
              <div>
                <label for="confirm_password">Confirm Password</label>
                <input id="confirm_password" name="confirm_password" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
              </div>
            </div>

            <div data-student-fields class="grid grid-2">
              <div>
                <label for="full_name">Full Name</label>
                <input id="full_name" name="full_name" required placeholder="Student name">
              </div>
              <div>
                <label for="enrollment_number">Enrollment Number</label>
                <input id="enrollment_number" name="enrollment_number" required placeholder="EN2026xxx">
              </div>
              <div>
                <label for="branch">Branch</label>
                <select id="branch" name="branch" required>
                  <option value="" disabled selected>Select branch</option>
                  <option value="CSE">CSE</option>
                  <option value="IT">IT</option>
                  <option value="ECE">ECE</option>
                  <option value="EEE">EEE</option>
                  <option value="ME">Mechanical</option>
                  <option value="CE">Civil</option>
                  <option value="Chemical">Chemical</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div>
                <label for="cgpa">CGPA</label>
                <input id="cgpa" name="cgpa" type="number" step="0.1" required placeholder="8.5">
              </div>
              <div>
                <label for="graduation_year">Graduation Year</label>
                <input id="graduation_year" name="graduation_year" type="number" required placeholder="2026">
              </div>
              <div>
                <label for="current_year">Current Year</label>
                <select id="current_year" name="current_year" required>
                  <option value="" disabled selected>Select current year</option>
                  <option value="1">1st year</option>
                  <option value="2">2nd year</option>
                  <option value="3">3rd year</option>
                  <option value="4">4th year</option>
                </select>
              </div>
              <div>
                <label for="batch_id">Batch ID (optional)</label>
                <input id="batch_id" name="batch_id" type="number" placeholder="e.g., 1">
                <p class="minor" style="margin-top: 4px;">If you know your batch mapping ID, add it; otherwise leave blank.</p>
              </div>
              <div>
                <label for="phone">Phone</label>
                <input id="phone" name="phone" type="tel" required placeholder="9876543210">
              </div>
            </div>

            <div data-company-fields class="grid grid-2 hidden">
              <div>
                <label for="company_name">Company Name *</label>
                <input id="company_name" name="company_name" required placeholder="TechCorp">
              </div>
              <div>
                <label for="industry">Industry *</label>
                <input id="industry" name="industry" required placeholder="Software Development">
              </div>
              <div>
                <label for="hr_name">HR Name *</label>
                <input id="hr_name" name="hr_name" required placeholder="Hiring lead">
              </div>
              <div>
                <label for="hr_phone">HR Phone *</label>
                <input id="hr_phone" name="hr_phone" required placeholder="9876543210">
              </div>
            </div>

            <button id="register-submit" class="btn btn-primary" type="submit" style="margin-top: 12px; padding: 14px;">Create Account</button>
          </form>
          <p class="minor" style="margin-top: 16px; text-align: center;">Already have an account? <a href="index.html" style="color: var(--accent-2); font-weight: 600;">Sign in</a></p>
        </div>
      </section>

      <section class="features-grid" style="margin-top: 60px;">
        <div class="feature-card">
          <div class="feature-icon">üéØ</div>
          <h3>For Students</h3>
          <p class="minor">Browse eligible jobs, track applications with kanban boards, and receive instant notifications about opportunities.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üè¢</div>
          <h3>For Companies</h3>
          <p class="minor">Post job openings, review candidate profiles, and manage the entire hiring process in one place.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">‚ú®</div>
          <h3>Smart Features</h3>
          <p class="minor">Resume scoring, skill gap analysis, and automated eligibility checking to streamline placements.</p>
        </div>
      </section>
    </div>
  </main>
  <script>
    const API_BASE = '/api';
    function showToast(msg, type = 'info') {
      let stack = document.getElementById('toast-stack');
      if (!stack) {
        stack = document.createElement('div');
        stack.id = 'toast-stack';
        stack.className = 'toast-stack';
        document.body.appendChild(stack);
      }
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = msg;
      stack.appendChild(toast);
      setTimeout(() => toast.remove(), 4200);
    }

    const form = document.querySelector('#register-form');
    const roleRadios = document.querySelectorAll('input[name="role"]');
    const studentFields = document.querySelector('[data-student-fields]');
    const companyFields = document.querySelector('[data-company-fields]');
    const submitBtn = document.querySelector('#register-submit');

    function currentRole() {
      const checked = Array.from(roleRadios).find(r => r.checked);
      return checked ? parseInt(checked.value, 10) : 1;
    }

    function toggleFields() {
      const role = currentRole();
      if (role === 1) {
        studentFields?.classList.remove('hidden');
        companyFields?.classList.add('hidden');
      } else {
        studentFields?.classList.add('hidden');
        companyFields?.classList.remove('hidden');
      }
    }

    roleRadios.forEach(r => r.addEventListener('change', toggleFields));
    toggleFields();

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const role = currentRole();
      
      // Validate passwords match
      if (formData.get('password') !== formData.get('confirm_password')) {
        showToast('Passwords do not match', 'error');
        return;
      }

      // Validate password length
      if (formData.get('password').length < 6) {
        showToast('Password must be at least 6 characters', 'error');
        return;
      }

      const payload = {
        email: formData.get('email'),
        password: formData.get('password'),
        role_id: role,
      };

      if (role === 1) {
        // Student validation
        if (!formData.get('full_name') || !formData.get('enrollment_number') || !formData.get('branch') || !formData.get('cgpa') || !formData.get('graduation_year') || !formData.get('phone')) {
          showToast('Please fill all required student fields', 'error');
          return;
        }
        payload.full_name = formData.get('full_name');
        payload.enrollment_number = formData.get('enrollment_number');
        payload.branch = formData.get('branch');
        payload.cgpa = parseFloat(formData.get('cgpa'));
        payload.graduation_year = parseInt(formData.get('graduation_year'), 10);
        payload.current_year = parseInt(formData.get('current_year'), 10);
        const batchId = formData.get('batch_id');
        payload.batch_id = batchId ? parseInt(batchId, 10) : null;
        payload.phone = formData.get('phone');
      } else {
        // Company validation
        if (!formData.get('company_name') || !formData.get('industry') || !formData.get('hr_name') || !formData.get('hr_phone')) {
          showToast('Please fill all required company fields', 'error');
          return;
        }
        payload.company_name = formData.get('company_name');
        payload.industry = formData.get('industry');
        payload.hr_name = formData.get('hr_name');
        payload.hr_phone = formData.get('hr_phone');
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'Creating account...';
      try {
        const response = await fetch(`${API_BASE}/auth/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        }).catch(networkError => {
          throw new Error('Cannot connect to server. Please ensure the backend is running.');
        });
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Registration failed');
        }
        showToast('Account created successfully! Redirecting to login...', 'success');
        setTimeout(() => { window.location.href = 'index.html'; }, 1500);
      } catch (err) {
        console.error('Registration error:', err);
        showToast(err.message || 'Registration error', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create Account';
      }
    });
  </script>
</body>
</html>
